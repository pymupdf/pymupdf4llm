train_task_name: train
test_task_name: eval_det_model

train:
  device: 'cuda:0'
  load_from:
  load_optimizer: false
  auto_restart: false
  log_step: 50
  log_clear_step: 50000
  save_step: 1000
  eval_step: 1000
  sleep_time: 0.0
  num_epoch: 10000000000
  ema_decay: 0.999
  gradient_clip_norm: 1.0
  train_batch_size: 96
  val_batch_size: 96
  optimizer:
    type: Adam
    learning_rate: 1e-2
    weight_decay: 0.0005
    betas: [0.937, 0.999]
    momentum: 0.937
  scheduler:
    type: CLR
    base_lr: 1e-6
    max_lr: 1e-5
    gamma: 1.0
    cycle_steps: [ 1e-4, 1e-4, 1e-5, 1e-5, 1e-6 ]
    step_size: 10000
  loss:
    node_loss_type: CE
    edge_loss_type: CE
    weight:
    node_weight:
    edge_weight:
  train_dataset:
    type: lmdb
    lmdb_prob:
    lmdb_path:
      - /workspace/lmdb_data/train
    cache_size: 5000
    cache_rate: 0.5
  val_dataset:
    type: lmdb
    lmdb_path:
      - /workspace/lmdb_data/val
    cache_size: 0
  save_dir: /workspace/checkpoints

test:
  device: 'cuda:0'
  load_from: /workspace/checkpoints/model_best.pt
  sleep_time: 180
  pdf_dir: /datasets/DocLayNet/PDF
  pkl_dir: /workspace/pkl_data/val
  vis_pdf_dir: /workspace/visualizations
  eval_batch_size: 64
  eval_loop_dir:
    - /workspace/checkpoints
  eval_score_thr: 0.8
  eval_type: val

data:
  class_list: ['text', 'title', 'picture', 'table', 'list-item', 'page-header', 'page-footer', 'section-header', 'footnote','caption','formula', 'unlabelled']
  class_priority: [1, 5, 6, 4, 0, 3, 2, 7, 8, 9, 10, 11]
  rf_names: ['num_ratio', 'is_text', 'is_vector', 'is_image', 'is_hline_vector', 'is_vline_vector', 'alignment_down_with_centre','alignment_down_with_left','alignment_down_with_right','alignment_left_with_bottom','alignment_left_with_middle','alignment_left_with_top','alignment_right_with_bottom','alignment_right_with_middle','alignment_right_with_top','alignment_up_with_centre','alignment_up_with_left','alignment_up_with_right','bottom_right_x','char_space','char_space_n','consecutive_bottom_alignment_count_left','consecutive_bottom_alignment_count_right','consecutive_centre_alignment_count_down','consecutive_centre_alignment_count_up','consecutive_left_alignment_count_down','consecutive_left_alignment_count_up','consecutive_middle_alignment_count_left','consecutive_middle_alignment_count_right','consecutive_right_alignment_count_down','consecutive_right_alignment_count_up','consecutive_top_alignment_count_left','consecutive_top_alignment_count_right','context_above_font_size','context_above_indent','context_above_is_header','context_above_outdent','context_below_bullet','context_below_font_size','context_below_indent','context_below_is_header','context_below_outdent','context_header_differs','dodgy_paragraph_breaks','font_size','fonts_offset','imargin_b','imargin_l','imargin_r','imargin_t','is_header', 'line_bullets','line_space','linespaces_offset','margin_b','margin_l','margin_r','margin_t','max_non_first_left_indent','max_non_last_right_indent','non_line_bullets','num_fonts_in_region','num_lines','num_non_numerals','num_numerals','num_underlines','ratio','ray_line_distance_down','ray_line_distance_left','ray_line_distance_right','ray_line_distance_up','smargin_b','smargin_l','smargin_r','smargin_t', 'top_left_x',]

model:
  type: 'DGCNN'
  name: 'BoxRFDGCNN'
  option:
    normalization: ['BBX', 'BRF', 'BTX', 'BIM', 'BFS']
    conv_type: 'CustomDGC'
    conv_num: 2
    conv_merge_type:
    feature_types: ['bbox', 'rf', 'text_pattern']
    edge_type: SEO
    training_noise_prob: 0.0
    training_noise: 0.0
    drop_ngc: 0.0
    drop_egc: 0.0
  sample_k: 20
  hidden_dim: 512
  node_input_dim: 8
  node_output_dim: 256
  edge_input_dim: 24
  rf_output_dim: 48
  txp_input_dim: 40
  txp_output_dim: 10
  imf_input_dim: 344
  imf_output_dim: 256
  dgcn_dim: 128
  dgcn_aggr: softmax

export2onnx:
  model_cfg:  /workspace/checkpoints/model.yaml
  check_point: /workspace/checkpoints/model_best.pt
  save_path:  /workspace/checkpoints/model.onnx
  verification_threshold: 0.001

train_segmentation:
  task: train
  device: 'cuda:0'
  model:
    name: 'UNet-thin'
    target_type: 'segmentation'
    in_ch: 1
    out_ch: 12
    use_sep: false
    image_size:
      type: Fix
      size: [500, 500]
    mask_size:
      type: Original
      size:
    output_name: ''
    num_filters: 32
  loss_type:
    - type: 'CE'
      weight: 1.0
  class_list: ['text', 'title', 'picture', 'table', 'list-item', 'page-header', 'page-footer', 'section-header', 'footnote', 'caption', 'formula']
  data_class_change_map:
    table-cell:
    form: table
    key-value-region: text
    checkbox-selected: text
    checkbox-unselected: text
    code: text
  class_weight:
  train_style: 'SEG'
  batch_size: 36
  learning_rate: 1e-4
  scheduler:
    base_lr: 1e-4
    max_lr: 1e-4
    step_size: 10000
  augmentation:
    crop_prob: 0.25
    crop_ratio: [0.8, 1.0]
    noise_prob: 0.1
    noise_ratio: 0.01
  num_workers: 2
  train_pkl_prob:
  train_pkl_dir:
    - /workspace/pkl_data/train
  train_pdf_dir:
    - /datasets/DocLayNet/PDF
  train_cache_size: 1000
  train_cache_rate: 0.5
  val_pkl_dir:
    - /workspace/pkl_data/val
  val_pdf_dir:
    - /datasets/DocLayNet/PDF
  num_epochs: 10000
  log_interval: 10
  show_interval: 10
  eval_interval: 1000
  sleep_time: 0.0
  load_from:
  onnx_save:
  save_dir: /checkpoints/segmentation
  pdf_dir:
